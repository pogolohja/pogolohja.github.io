<!doctype html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/css/ol.css" type="text/css">
    <style>
      .map {
        height: 700px;
        width: 100%;
      }
    </style>
    <script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>
    <title>PoGo Lohja</title>
  </head>
  <body>

    <h2 id="header"></h2>

    <div id="map" class="map"></div>
    <script type="text/javascript">

      const urlParams = new URLSearchParams(window.location.search);

      function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
      }

//      document.getElementById("header").innerHTML = getParameterByName('foo');

      var eggs = urlParams.getAll('egg');
      var eggFeatures = [];
      for (var i = 0; i < eggs.length; i++) {
          var params = eggs[i].split(';');
          var long = params[1].split('.');
          var lat = params[2].split('.');
          eggFeatures.push(new ol.Feature({ geometry: new ol.geom.Point(ol.proj.fromLonLat(
            [parseInt(long[0], 10) + parseInt(long[1], 10) / (10 ^ long[1].length),
            parseInt(lat[0], 10) + parseInt(lat[1], 10) / (10 ^ lat[1].length)]
            )) }));
          var eggtier = 'egg5.png';
          if ((params[0] == '1') || (params[0] == '2')) { eggtier = 'egg12.png'; }
          if ((params[0] == '3') || (params[0] == '4')) { eggtier = 'egg34.png'; }
          eggFeatures[i].setStyle(new ol.style.Style({
              image: new ol.style.Icon(/** @type {module:ol/style/Icon~Options} */ ({
                crossOrigin: 'anonymous',
                src: eggtier,
                scale: 0.5
              }))
            }));
      }

      var vectorSource = new ol.source.Vector({
        features: eggFeatures
      });

      var vectorLayer = new ol.layer.Vector({
        source: vectorSource
      });


      var map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          }),
          vectorLayer
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([24.05, 60.23]),
          zoom: 12
        })
      });
    </script>
  </body>
</html>
